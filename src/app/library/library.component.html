<div class="main">
  <div class="container-fluid">
    <div class="row page-header">
      <div class="col-sm-3 title"><img src="../../../assets/images/merchant.svg" />
        <span class="pl-2">{{ pageHeader }}</span>
        <span class="count pl-2">({{ libCount }})</span>
      </div>
      <!-- <div class="col-sm-7  tools text-right">
          
        </div> -->
      <div class="col-sm-9 tools text-right">
            <!-- <span class="pr-4">
              <span class="pr-2">Select Application</span>
              <select id="app" (change)="changeApp($event.target.value)" class="select-app-select">
                <option value="" disabled selected>Select Application</option>
                <option *ngFor="let a of apps" [value]="a.id" [selected]="app.id == a.id" >{{a.name}}</option>
              </select>
          </span> -->
        <button class="button" (click)="create(libModal)" *ngIf="hasAccess(actionEnum.add)">
          <fa-icon [icon]='faPlus' size="lg"></fa-icon><span class="pl-2">Add
            New Bundle</span>
        </button>
      </div>
    </div>
    <div *ngIf="libCount === 0" class="info">
      No libraries are created yet for the selected application.
      <ul>
        <li>New library can be created by using <span class="info-highlight">Add New Bundle</span> option.</li>
      </ul>
    </div>
    <!-- <div *ngIf="appCount > 0 && libCount > 0" class="text-right select-app">
      
    </div> -->
    <div class="pt-2" *ngIf="libCount > 0">

      <table class="table table-striped">
        <thead>
          <tr>
            <th scope="col" style="width: 15%;">Name</th>
            <th scope="col" style="width: 15%;">Application</th>
            <!-- <th scope="col">Type</th> -->
            <th scope="col" style="width: 8%;">Version</th>
            <!-- <th scope="col">Base Version</th> -->
            <!-- <th scope="col">Description</th> -->
            <th scope="col" style="width: 8%;">Bundle Name</th>
            <th scope="col" style="width: 8%;">Bundle Size</th>
            <th scope="col" style="width: 8%;">Post Action</th>
            <!-- <th scope="col" style="width: 8%;">Post Action Delay</th> -->
            <th scope="col" style="width: 8%;">Status</th>
            <th scope="col" style="width: 10%;">Last Update By</th>
            <th scope="col" style="width: 10%;">Last Update On</th>
            <th scope="col" style="width: 10%;">Action</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let lib of libs | slice: (page-1) * pageSize : (page-1) * pageSize + pageSize">
            <td><span class="table-col-name">{{ lib.name }}</span></td>
            <td>{{ lib.app.name }}</td>
            <!-- <td>{{ lib.type }}</td> -->
            <td>{{ lib.libBaseVersion+'.'+lib.libVersion }}</td>
            <!-- <td>{{ lib.libBaseVersion }}</td>
            <td>{{ lib.desc }}</td> -->
            <td>{{ lib.bundleName }}</td>
            <td>{{ lib.bundleSize }}</td>
            <td>{{ getPostActionDetails(lib.postAction, lib.postActionDelay) }}</td>
            <!-- <td>{{ lib.postActionDelay }}</td> -->
            <td>{{ getStatus(lib.status) }}</td>
            <td>{{ lib.lastUpdatedBy }}</td>
            <td>{{ lib.updatedDate | date: 'dd/MM/yyyy HH:mm'}}</td>
            <td *ngIf="hasActionAccess()">
              <span class="pr-3" *ngIf="hasAccess(actionEnum.view)">
                <a (click)="view(lib.id, libModal)" routerLinkActive="active" ngbTooltip="View" tooltipClass="tool-tip">
                  <fa-icon [icon]='faEye' style="color:#1653da"></fa-icon>
                </a>
              </span>
              <span class="pr-3" *ngIf="hasAccess(actionEnum.edit) && lib.status !== 2">
                <a (click)="edit(lib.id, libModal)" routerLinkActive="active" ngbTooltip="Edit" tooltipClass="tool-tip">
                  <fa-icon [icon]='faEdit' style="color:#ffc107;"></fa-icon>
                </a>
              </span>
              <span class="pr-3" *ngIf="hasAccess(actionEnum.delete) && lib.status !== 2">
                <a (click)="openConfirmation(actionConfirm, 'lib', actionEnum.delete, lib.id, lib.name)" routerLinkActive="active" ngbTooltip="Delete" tooltipClass="tool-tip">
                  <fa-icon [icon]='faArchive' style="color: #dc3545;"></fa-icon>
                </a>
              </span>
              <span *ngIf="hasAccess(actionEnum.activate) && lib.status === 0">
                <a (click)="openConfirmation(actionConfirm, 'lib', actionEnum.activate, lib.id, lib.name)" routerLinkActive="active" ngbTooltip="Activate" tooltipClass="tool-tip">
                  <fa-icon [icon]='faCheckCircle' style="color: #20c997;"></fa-icon>
                </a>
              </span>
              <span *ngIf="hasAccess(actionEnum.activate) && lib.status === 1">
                <a (click)="openConfirmation(actionConfirm, 'lib', actionEnum.inActivate, lib.id, lib.name)" routerLinkActive="active" ngbTooltip="In-Activate" tooltipClass="tool-tip">
                  <fa-icon [icon]='faBan' style="color: #fd7e14;"></fa-icon>
                </a>
              </span>
            </td>
          </tr>
        </tbody>
      </table>

      <div class="d-flex justify-content-between px-2">
        <ngb-pagination [collectionSize]="libCount" [(page)]="page" [pageSize]="pageSize">
        </ngb-pagination>

        <select [(ngModel)]="pageSize" class="paging">
          <option [ngValue]="5">5 items per page</option>
          <option [ngValue]="10">10 items per page</option>
          <option [ngValue]="25">25 items per page</option>
        </select>
      </div>
    </div>
  </div>
</div>
<ng-template #libModal let-modal>
  <app-library-form [actionType]="actionType" [merchant]="merchant" [apps]="apps" [lib]="lib" (modalClosed)='closeModal($event)'></app-library-form>
</ng-template>
<ng-template #actionConfirm let-modal>
  <app-confirm-dialog [resource]='confirmResource' (modalClosed)='closeConfirmation($event)'></app-confirm-dialog>
</ng-template>